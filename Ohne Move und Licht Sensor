#include <LiquidCrystal.h>
#include "DHT.h"
#include <Adafruit_NeoPixel.h>
#ifdef __AVR__
  #include <avr/power.h>
#endif
#define DHTPIN 7
#define DHTTYPE DHT11
#define LEDInfo 9
Adafruit_NeoPixel stripInfo = Adafruit_NeoPixel(12, LEDInfo, NEO_GRB + NEO_KHZ800);

#define LEDShow 6
Adafruit_NeoPixel stripShow = Adafruit_NeoPixel(12, LEDShow, NEO_GRB + NEO_KHZ800);




//LCD
const int RS = 11, EN = 12, D4 = 2, D5 = 3, D6 = 4, D7 = 5; //LCD Pins
LiquidCrystal lcd(RS, EN, D4, D5, D6, D7);

//Temperatur und Humidity Sensor
DHT dht(DHTPIN, DHTTYPE);

//Rotary Encoder declare
int val;
int encoder0PinA = 10;
int encoder0PinB = 13;
int encoder0Pos = 0;
int encoder0PinALast = LOW;
int n = LOW;




void setup() {
  //Setup Serial Encoder
  Serial.begin(9600);
  
  //Setup LCD
  lcd.begin(16, 2); // set up number of columns and rows

  //Setup Temp und Humitity Sensor + Serial Ausgabe für Kontrolle
  dht.begin();

  //Setup Rotary Encoder
  pinMode (encoder0PinA, INPUT);
  pinMode (encoder0PinB, INPUT);

  //Adafruit LED-Strip
  #if defined (__AVR_ATtiny85__)
    if (F_CPU == 16000000) clock_prescale_set(clock_div_1);
  #endif
}




void loop() {
  delay(200);

  float humi  = dht.readHumidity(); //Luftfeuchtigkeits Messung
  float tempC = dht.readTemperature(); //Temperatur Messung in Celsius

  if (isnan(humi) || isnan(tempC)){
    Serial.println("Failed to read from DHT sensor!");
  } else {
    Serial.print("Humidity: ");
    Serial.print(humi);
    Serial.print("%");

    Serial.print("  |  "); 

    Serial.print("Temperature: ");
    Serial.print(tempC);
    Serial.print("°C ~ ");

    lcd.setCursor(0, 0);
    lcd.print("Temp akt:");
    lcd.setCursor(15, 0);
    lcd.print("C");
    lcd.setCursor(10, 0);
    lcd.print(tempC);

    n = digitalRead(encoder0PinA);
    if ((encoder0PinALast == LOW) && (n == HIGH)) {
      if (digitalRead(encoder0PinB) == LOW) {
        encoder0Pos--;
      } else {
        encoder0Pos++;
      }
      Serial.print (encoder0Pos);
      Serial.print ("/");
      
      lcd.setCursor(0, 1);
      lcd.print("Set Temp:");
      lcd.setCursor(15, 1);
      lcd.print("C");
      lcd.setCursor(10, 1);
      lcd.print(encoder0Pos);
      
      }
    encoder0PinALast = n;
    }

  if (tempC < 16.00){
    stripInfo.begin();
    stripInfo.setBrightness(20);
    stripInfo.show();
    colorWipe(stripInfo.Color(255, 0, 0), 255);
    stripShow.begin();
    stripShow.setBrightness(10);
    stripShow.show();
    rainbow(50);
  } else if (tempC <= 21.00) {
    stripInfo.begin();
    stripInfo.setBrightness(20);
    stripInfo.show();
    colorWipe(stripInfo.Color(255, 255, 0), 255);
    stripShow.begin();
    stripShow.setBrightness(10);
    stripShow.show();
    rainbow(50);
  } else if (tempC < 25.00) {
    stripInfo.begin();
    stripInfo.setBrightness(20);
    stripInfo.show();
    colorWipe(stripInfo.Color(0, 255, 0), 255);
    stripShow.begin();
    stripShow.setBrightness(10);
    stripShow.show();
    rainbow(50);
  } else {
    stripInfo.begin();
    stripInfo.setBrightness(20);
    stripInfo.show();
    colorWipe(stripInfo.Color(50, 50, 50), 50);
    stripShow.begin();
    stripShow.setBrightness(10);
    stripShow.show();
    rainbow(50);
  }
    

  }




void colorWipe(uint32_t color, int wait) {
  for(int i=0; i<stripInfo.numPixels(); i++) {
    stripInfo.setPixelColor(i, color);
    stripInfo.show();
    delay(wait);
  }
}



void rainbow(int wait) {
  for(long firstPixelHue = 0; firstPixelHue < 25000*65536; firstPixelHue += 256) {
    stripShow.rainbow(firstPixelHue);
    stripShow.show();
    delay(wait);
  }
}

#include <LiquidCrystal.h>
#include "DHT.h"
#include <Adafruit_NeoPixel.h>
#ifdef __AVR__
  #include <avr/power.h>
#endif
#define DHTPIN 7
#define DHTTYPE DHT11
#define PIN 9
Adafruit_NeoPixel strip = Adafruit_NeoPixel(60, PIN, NEO_GRB + NEO_KHZ800);




//LCD
const int RS = 11, EN = 12, D4 = 2, D5 = 3, D6 = 4, D7 = 5; //LCD Pins
LiquidCrystal lcd(RS, EN, D4, D5, D6, D7);

//Temperatur und Humidity Sensor
DHT dht(DHTPIN, DHTTYPE);

//Rotary Encoder declare
int val;
int encoder0PinA = 10;
int encoder0PinB = 13;
int encoder0Pos = 0;
int encoder0PinALast = LOW;
int n = LOW;




void setup() {
  //Setup Serial Encoder
  Serial.begin(9600);
  
  //Setup LCD
  lcd.begin(16, 2); // set up number of columns and rows

  //Setup Temp und Humitity Sensor + Serial Ausgabe für Kontrolle
  dht.begin();

  //Setup Rotary Encoder
  pinMode (encoder0PinA, INPUT);
  pinMode (encoder0PinB, INPUT);

  //Adafruit LED-Strip
  #if defined (__AVR_ATtiny85__)
    if (F_CPU == 16000000) clock_prescale_set(clock_div_1);
  #endif

  strip.begin();
  strip.setBrightness(10);
  strip.show();
}




void loop() {
  delay(200);

  float humi  = dht.readHumidity(); //Luftfeuchtigkeits Messung
  float tempC = dht.readTemperature(); //Temperatur Messung in Celsius

  if (isnan(humi) || isnan(tempC)){
    Serial.println("Failed to read from DHT sensor!");
  } else {
    Serial.print("Humidity: ");
    Serial.print(humi);
    Serial.print("%");

    Serial.print("  |  "); 

    Serial.print("Temperature: ");
    Serial.print(tempC);
    Serial.print("°C ~ ");

    lcd.setCursor(0, 0);
    lcd.print("Temp akt:");
    lcd.setCursor(15, 0);
    lcd.print("C");
    lcd.setCursor(10, 0);
    lcd.print(tempC);

    n = digitalRead(encoder0PinA);
    if ((encoder0PinALast == LOW) && (n == HIGH)) {
      if (digitalRead(encoder0PinB) == LOW) {
        encoder0Pos--;
      } else {
        encoder0Pos++;
      }
      Serial.print (encoder0Pos);
      Serial.print ("/");
      
      lcd.setCursor(0, 1);
      lcd.print("Set Temp:");
      lcd.setCursor(15, 1);
      lcd.print("C");
      lcd.setCursor(10, 1);
      lcd.print(encoder0Pos);
      
      }
    encoder0PinALast = n;
    }


  colorWipe(strip.Color(250, 0, 0), 50);
  colorWipe(strip.Color(200, 0, 0), 50);
  colorWipe(strip.Color(150, 0, 0), 50);
  colorWipe(strip.Color(100, 0, 0), 50);
  colorWipe(strip.Color(50, 0, 0), 50);

  colorWipe(strip.Color(0, 250, 0), 50);
  colorWipe(strip.Color(0, 200, 0), 50);
  colorWipe(strip.Color(0, 150, 0), 50);
  colorWipe(strip.Color(0, 100, 0), 50);
  colorWipe(strip.Color(0, 50, 0), 50);
  
  colorWipe(strip.Color(0, 0, 250), 50);
  colorWipe(strip.Color(0, 0, 200), 50);
  colorWipe(strip.Color(0, 0, 150), 50);
  colorWipe(strip.Color(0, 0, 100), 50);
  colorWipe(strip.Color(0, 0, 50), 50);


  }




void colorWipe(uint32_t c, uint8_t wait) {
  for(uint16_t i=0; i<strip.numPixels(); i++) {
    strip.setPixelColor(i, c);
    strip.show();
    delay(10);  }
  }
